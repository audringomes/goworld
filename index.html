<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Goworld by kpawlik</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Goworld</h1>
      <h2 class="project-tagline">Test app which allow to access Smallworld data as JSON via HTTP </h2>
      <a href="https://github.com/kpawlik/goworld" class="btn">View on GitHub</a>
      <a href="https://github.com/kpawlik/goworld/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/kpawlik/goworld/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="goworld" class="anchor" href="#goworld" aria-hidden="true"><span class="octicon octicon-link"></span></a>goworld</h1>

<p>Aplication which allows to access Smallworld data as JSON via HTTP</p>

<hr>

<h2>
<a id="table-of-contents" class="anchor" href="#table-of-contents" aria-hidden="true"><span class="octicon octicon-link"></span></a>Table of Contents</h2>

<ul>
<li>
<a href="#about">About</a>

<ul>
<li><a href="#features">Features</a></li>
<li><a href="#config-file">Config file</a></li>
</ul>
</li>
<li><a href="#download">Downloads</a></li>
<li><a href="#build">Build from sources</a></li>
<li>
<a href="#tutorial">Tutorial</a>

<ul>
<li><a href="#quick-start">Quick start</a></li>
<li><a href="#protocol">Protocol</a></li>
<li><a href="#stop">Stop</a></li>
</ul>
</li>
<li><a href="#limitations">Limitations</a></li>
</ul>

<hr>

<p></p><div id="about"></div>

<h2>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h2>

<p>This is a simple application which shows how data from Smallworld can be accessed via HTTP in JSON format. Goworld is composed of set of concurrent workers and one HTTP server. Worker communicates with Smallworld session via ACP protocol. HTTP server and workers communicates via RPC protocol. HTTP server publish data from workers as JSON.</p>

<p></p><div id="features"></div>

<h3>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h3>

<ul>
<li>Zero instalation</li>
<li>One executable</li>
<li>Siple, light and fast</li>
<li>Linux/Windows support</li>
<li>One simple config file</li>
<li>Scalable - many ACP workers -&gt; one concurrency HTTP server</li>
<li>Many workers on single Smallworld session</li>
</ul>

<p></p><div id="config-file"></div>

<h3>
<a id="config-file" class="anchor" href="#config-file" aria-hidden="true"><span class="octicon octicon-link"></span></a>Config file</h3>

<p>Config file is a simple JSON file.</p>

<pre><code>
{
    "server": {
        "port": Number
    },
    "workers": [
        {
            "port": Number,
            "host": String,
            "name": String
        },
    ...
    ...
    ...
    ]
}
</code></pre>

<p><code>server</code> - HTTP server configuration</p>

<p><code>server.port</code> - HTTP server port number </p>

<p><code>workers</code> - list of workers configuration obejcts</p>

<p><code>worker.port</code> - port number to communication via RPC between HTTP server and worker</p>

<p><code>worker.host</code> - host name, where worker is started</p>

<p><code>worker.name</code> - unique name of worker. This will be also used as a APC process name</p>

<hr>

<p></p><div id="download"></div>

<h2>
<a id="downloads" class="anchor" href="#downloads" aria-hidden="true"><span class="octicon octicon-link"></span></a>Downloads</h2>

<p><a href="https://sourceforge.net/projects/goworld/files/?source=navbar">Binaries</a></p>

<p><a href="https://github.com/kpawlik/goworld">Source</a></p>

<p></p><div id="build"></div>

<h2>
<a id="build-from-sources" class="anchor" href="#build-from-sources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Build from sources</h2>

<h3>
<a id="prerequisites" class="anchor" href="#prerequisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Prerequisites</h3>

<p>Install Go SDK (or extract zip archive) and setup GOPATH</p>

<p><a href="https://golang.org/dl/">Go download</a></p>

<p><a href="https://github.com/golang/go/wiki/GOPATH">GOPATH</a></p>

<h3>
<a id="instalation" class="anchor" href="#instalation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Instalation</h3>

<p><code>go get github.com/kpawlik/goworld</code></p>

<h3>
<a id="compilation" class="anchor" href="#compilation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Compilation</h3>

<p>go to <code>GOPATH/github.com/kpawlik/goworld/goworldc</code> run:</p>

<p><code>go build main.go -o c:\tmp\goworld.exe</code></p>

<hr>

<p></p><div id="tutorial"></div>

<h2>
<a id="tutorial" class="anchor" href="#tutorial" aria-hidden="true"><span class="octicon octicon-link"></span></a>Tutorial</h2>

<p></p><div id="quick-start"></div>

<h3>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick start</h3>

<ul>
<li><p>Download appropriate executable file to <code>C:\tmp\</code></p></li>
<li><p>Create JSON config file c:\tmp\goworld.json</p></li>
</ul>

<pre><code>
{
    "server": {
        "port": 4000
    },
    "workers": [{
        "port": 4002,
        "host": "localhost",
        "name": "w1"
    }, {
        "port": 4001,
        "host": "localhost",
        "name": "w2"
    }]
}
</code></pre>

<ul>
<li><p>load Magik source file <code>goworld.magik</code> from <code>magik</code> folder into the Smallworld session</p></li>
<li>
<p>in the Smallworld console type: </p>

<pre><code>
start_goworld_worker("w1", "c:\tmp\goworld.exe", "c:\tmp\goworld.json", "c:\tmp\w1.log")
$
start_goworld_worker("w2", "c:\tmp\goworld.exe", "c:\tmp\goworld.json", "c:\tmp\w2.log")
$
</code></pre>

<p>this, will start two concurrent workers <code>w1</code> and <code>w2</code>, which will communicate with HTTP server via RPC protocol on ports 4001 n 4002.
Procedure <code>start_goworld_worker</code> takes 4 parameters: </p>

<ul>
<li><code>worker_name</code></li>
<li><code>path to goworld.exe</code></li>
<li><code>path to config file</code></li>
<li><code>path where worker log file will be written</code></li>
</ul>
</li>
<li>
<p>in Windows command line type:</p>

<pre><code>
c:\tmp\goworld.exe -t http -c c:\tmp\goworld.json
</code></pre>

<p>this, will start the HTTP server on port 4000</p>
</li>
<li>
<p>start internet browser and type in address bar</p>

<pre><code>
http://localhost:4000/[DATASET NAME]/[COLLECTION NAME]/[NO OF RECORDS, 0 = ALL]/[LIST OF FIELDS SEPARATED BY "/"]
eg.
http://localhost:4000/gis/hotel/100/id/name/address1/address2
</code></pre>

<p>application will display list 100 (or less if size of collection is less then 100) of JSON object eg.</p>
</li>
</ul>

<pre><code>
[
    {
        "address1": "154 Palad Road",
        "address2": "Wyoming",
        "id": "condition(does_not_understand: Object hotel133:(AAA Guest House) does not understand message id)",
        "name": "AAA Guest House"
    },
    {
        "address1": "219 Pinguin Road",
        "address2": "Miami",
        "id": "condition(does_not_understand: Object hotel133:(All 5 Seasons) does not understand message id)",
        "name": "All 5 Seasons"
    },
    ...
    ...
    ...
]
</code></pre>

<p></p><div id="protocol"></div>

<h3>
<a id="protocol" class="anchor" href="#protocol" aria-hidden="true"><span class="octicon octicon-link"></span></a>Protocol</h3>

<p>In current implementation the <code>goworld</code> protocol looks like this</p>

<ol>
<li>
<p><code>goworld</code> send to magik a char vector, this is a path from http address. eg for 
<code>http://localhost:4000/gis/hotel/100/id/name/address1/address2</code> it will be <code>gis/hotel/100/id/name/address1/address2</code>.</p>

<pre><code>
_local path </code></pre>
</li>
<li>
<p>magik ACP send to goworld number of record which will be send as <code>unsigned int</code></p>

<pre><code>
_self.put_unsigned_int(records_to_get)
</code></pre>
</li>
<li>
<p>magik ACP send to goworld number of fields which will be send as <code>unsigned int</code></p>

<pre><code>
_self.put_unsigned_int(no_of_fields)
</code></pre>
</li>
<li>
<p>in the loop magik ACP sends field names and field values</p>

<pre><code>
_self.put_chars(field_name)
_self.flush()
_self.put_chars(field_value)
_self.flush()
</code></pre>
</li>
</ol>

<p>In example magik file, path value is parsed as pattern:</p>

<p><code>http://localhost:4000/[DATASET NAME]/[COLLECTION NAME]/[NO OF RECORDS, 0 = ALL]/[LIST OF FIELDS SEPARATED BY "/"]</code></p>

<p>But in your own magik class you can handle <code>path</code> value in your own way eg.</p>

<p><code>http://localhost:4000/[DATASET NAME]/[COLLECTION NAME]/[FIELD NAME]/[SEARCHED VALUE]</code></p>

<p>and build a query from <code>FIELD NAME</code> and <code>SEARCHED VALUE</code>. This will work until communication between  goworker and magik ACP will be proceeded in accordance with the protocol.</p>

<p></p><div id="stop"></div>

<h3>
<a id="stop" class="anchor" href="#stop" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stop</h3>

<p>To stop Acp just open system Task Manager and kill all <code>goworld</code> processes.</p>

<hr>

<p></p><div id="limitations"></div>

<h3>
<a id="limitations" class="anchor" href="#limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Limitations</h3>

<p>Currently if you type wrong <code>dataset</code> or <code>collection</code> name in http address, magik Acp will crush and probably you need stop HTTP server before you will start it again. That is because wrong HTTP request is still pending .</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/kpawlik/goworld">Goworld</a> is maintained by <a href="https://github.com/kpawlik">kpawlik</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

