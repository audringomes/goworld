{"name":"Goworld","tagline":"Simple application  to serve Smallworld data as  HTTP /JSON ","body":"# goworld\r\n\r\nAplication which allows to access Smallworld data as JSON via HTTP\r\n\r\n[Visit project page] (http://kpawlik.github.io/goworld)\r\n\r\n***\r\n\r\n## Table of Contents\r\n- [About](#about)\r\n  - [Features](#features)\r\n- [Configuration](#config)\r\n  - [Configuration file](#config-file)\r\n  - [List protocol](#config-list-protocol)\r\n  - [Custom protocol](#config-custom-protocol)\r\n- [Downloads](#download)\r\n- [Build from sources](#build)\r\n- [Tutorial](#tutorial)\r\n  - [Quick start](#tutorial-quick-start)\r\n  - [Define custom protocol](#tutorial-custom-protocol)\r\n- [Protocol](#protocol)\r\n  - [List protocol](#protocol-list)\r\n  - [Custom protocol](#protocol-custom)\r\n- [Stop](#stop)\r\n\r\n\r\n***\r\n\r\n<div id='about'/>\r\n## About\r\n\r\nThis is a simple application which shows how data from Smallworld can be accessed via HTTP in JSON format. Goworld is composed of set of concurrent workers and one HTTP server. Worker communicates with Smallworld session via ACP protocol. HTTP server and workers communicates via RPC protocol. HTTP server publish data from workers as JSON.\r\n\r\n<div id='features'/>\r\n### Features \r\n\r\n- Zero instalation\r\n- One executable\r\n- Siple, light and fast\r\n- Linux/Windows support\r\n- One simple config file\r\n- Scalable - many ACP workers -> one concurrency HTTP server\r\n- Many workers on single Smallworld session\r\n\r\n<div id='config'/>\r\n## Configuration\r\n\r\n<div id='config-file'/>\r\n### Configuration file\r\n\r\nConfig file is a simple JSON file.\r\n<pre><code>\r\n{\r\n    \"server\": {\r\n        \"port\": Number,\r\n\t\t\"protocols\": \r\n\t\t\t[\r\n\t\t\t...\r\n\t\t\t]\r\n    },\r\n    \"workers\": [\r\n\t    {\r\n        \t\"port\": Number,\r\n\t        \"host\": String,\r\n\t        \"name\": String\r\n    \t},\r\n\t...\r\n\r\n\t]\r\n}\r\n</code></pre>\r\n\r\n`server` - HTTP server configuration\r\n\r\n`server.port` - HTTP server port number \r\n\r\n`server.protocols` - list of protocols definitions. See [Protocols](#protocol)\r\n\r\n`workers` - list of workers configuration obejcts\r\n\r\n`worker.port` - port number to communication via RPC between HTTP server and worker\r\n\r\n`worker.host` - host name, where worker is started\r\n\r\n`worker.name` - unique name of worker. This will be also used as a APC process name\r\n\r\n<div id='config-list-protocol'/>\r\n### List protocol\r\n\r\nThis is preconfigured protocol described in [quick start](#tutorial-quick-start).\r\nTo disable this protocol set `false` in enabled attribute, or remove whole JSON object from configuration file. \r\n\t<pre><code>\r\n\t {\r\n      \"name\": \"list\",\r\n      \"enabled\": bool\r\n    },\r\n\t</pre></code>\r\n\r\n<div id='config-custom-protocol'/>\r\n### Custom protocol\r\n   To define custom protocol you need to configure definition in configuration file.\r\nConfiguration:\r\n\t<pre><code>\r\n\t {\r\n      \"name\": string,\r\n      \"enabled\": bool,\r\n      \"params\": [\r\n        {\r\n          \"name\": string,\r\n          \"type\": string\r\n        }\r\n\t\t...\r\n      ],\r\n      \"results\": [\r\n        {\r\n          \"name\": string,\r\n          \"type\": string\r\n        }\r\n\t\t...\r\n      ]\r\n    },\r\n\t</code></pre>\r\n\r\n<div id='download'/>\r\n## Downloads\r\n\r\n[Binaries download](https://sourceforge.net/projects/goworld/files/?source=navbar)\r\n\r\n[Source download](https://github.com/kpawlik/goworld)\r\n\r\n<div id='build'/>\r\n## Build from sources\r\n\r\n### Prerequisites\r\nInstall Go SDK (or extract zip archive) and setup GOPATH\r\n\r\n[Go download](https://golang.org/dl/)\r\n\r\n[GOPATH](https://github.com/golang/go/wiki/GOPATH)\r\n\r\n\r\n### Instalation\r\n\r\n`go get github.com/kpawlik/goworld`\r\n\r\n### Compilation\r\n\r\ngo to `GOPATH/github.com/kpawlik/goworld/goworldc` run:\r\n\r\n`go build main.go -o c:\\tmp\\goworld.exe`\r\n\r\n\r\n<div id='tutorial'/>\r\n## Tutorial\r\n\r\n<div id='tutorial-quick-start'/>\r\n### Quick start\r\n\r\nThis example is for Windows, but this works the same way for Linux. This quick start example shows \r\nhow to run `goworld` with example `list` protocol, which just lists fields from Smallworld objects.\r\n\r\n- Download appropriate executable file to `C:\\tmp\\`\r\n\r\n- Create JSON config file c:\\tmp\\goworld.json\r\n\r\n\t<pre><code>\r\n{\r\n\t\"server\": {\r\n\t\t\"port\": 4000,\r\n\t\t\"protocols\": \r\n\t\t\t[\r\n\t\t\t\t{\r\n\t\t\t\t\t\"name\": \"list\",\r\n\t\t\t\t\t\"enabled\": true\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t},\r\n\t\"workers\": [{\r\n\t\t\"port\": 4002,\r\n\t\t\"host\": \"localhost\",\r\n\t\t\"name\": \"w1\"\r\n\t}, {\r\n\t\t\"port\": 4001,\r\n\t\t\"host\": \"localhost\",\r\n\t\t\"name\": \"w2\"\r\n\t}]\r\n}\r\n\t</code></pre>\r\n\r\n- load Magik source file `goworld.magik` from `magik` folder into the Smallworld session\r\n\r\n- in the Smallworld console type: \r\n\t\r\n\t<pre><code>\r\nstart_goworld_worker(\"w1\", \"c:\\tmp\\goworld.exe\", \"c:\\tmp\\goworld.json\", \"c:\\tmp\\w1.log\")\r\n$\r\nstart_goworld_worker(\"w2\", \"c:\\tmp\\goworld.exe\", \"c:\\tmp\\goworld.json\", \"c:\\tmp\\w2.log\")\r\n$\r\n\t</code></pre>\r\n\r\n   this, will start two concurrent workers `w1` and `w2`, which will communicate with HTTP server via RPC protocol on ports 4001 n 4002.\r\nProcedure `start_goworld_worker` takes 4 parameters: \r\n   * `worker_name`\r\n   * `path to goworld.exe`\r\n   * `path to config file`\r\n   * `path where worker log file will be written`\r\n\r\n- open Windows command line and type:\r\n<pre><code>\r\nc:\\tmp\\goworld.exe -t http -c c:\\tmp\\goworld.json\r\n</code></pre>\r\n\r\n   this, will start the HTTP server on port 4000\r\n\r\n- start internet browser and type in address bar\r\n\t<pre><code>\r\nhttp://localhost:4000/list/[DATASET NAME]/[COLLECTION NAME]/[LIMIT, 0 = ALL]/[LIST OF FIELDS SEPARATED BY \"/\"]\r\neg.\r\nhttp://localhost:4000/list/gis/hotel/100/id/name/address1/address2\r\n\t</code></pre>\r\n\r\n   application will display list 100 (or less if size of collection is less then 100) of JSON object eg.\r\n\r\n\t<pre><code>\r\n[\r\n\t{\r\n\t\t\"address1\": \"154 Palad Road\",\r\n\t\t\"address2\": \"Wyoming\",\r\n\t\t\"id\": \"condition(does_not_understand: Object hotel133:(AAA Guest House) does not understand message id)\",\r\n\t\t\"name\": \"AAA Guest House\"\r\n\t},\r\n\t{\r\n\t\t\"address1\": \"219 Pinguin Road\",\r\n\t\t\"address2\": \"Miami\",\r\n\t\t\"id\": \"condition(does_not_understand: Object hotel133:(All 5 Seasons) does not understand message id)\",\r\n\t\t\"name\": \"All 5 Seasons\"\r\n\t},\r\n\t...\r\n\t...\r\n\t...\r\n]\r\n\t</code></pre>\r\n\r\n\r\n<div id='tutorial-custom-protocol'/>\r\n### Define custom protocol\r\n\r\n1. Get config file from [quick start](#tutorial-quick-start). Add new protocol definition with name `find_hotel`\r\n\t\r\n\t<pre><code>\r\n\t...\r\n\t\"protocols\": [\r\n\t\t{\r\n        \t\"name\": \"find_hotel\",\r\n\t        \"enabled\": true,\r\n\t        \"params\": [\r\n\t            {\r\n\t                \"name\": \"name\",\r\n\t                \"type\": \"chars\"\r\n\t            }\r\n\t        ],\r\n\t        \"results\": [\r\n\t            {\r\n\t                \"name\": \"address_1\",\r\n\t                \"type\": \"chars\"\r\n\t            },\r\n\t            {\r\n\t                \"name\": \"address_2\",\r\n\t                \"type\": \"chars\"\r\n\t            },\r\n\t            {\r\n\t                \"name\": \"x\",\r\n\t                \"type\": \"float\"\r\n\t            },\r\n\t\t\t\t{\r\n\t                \"name\": \"y\",\r\n\t                \"type\": \"float\"\r\n\t            }\r\n       \t \t]\r\n    \t}\r\n\t],\r\n\t...\r\n\t</code></pre>\r\n\r\n1. Create new Magik method in class goworld, this method will handle new protocol\r\n\r\n\t<pre><code>\r\n\t_method goworld.find_hotel_protocol()\r\n\t## \r\n\t## \r\n\t\t!print_float_precision! << 12\r\n\t\t# This will get name from \"params\"\r\n\t    _local name << _self.get_chars()\r\n\t    #send status\r\n\t    _self.send_success_status()\r\n\t    _self.flush()\r\n\t    _local ds << gis_program_manager.databases[:gis]\r\n\t    _local coll << ds.collections[:hotel]\r\n\t    _local select << coll.select(predicate.eq(:name, name))\r\n\t    # send no of recs\r\n\t    _self.put_unsigned_int(select.size)\r\n\t    _self.flush()       \r\n\t    # send results fields in the same order as in config file \r\n\t    _for rec _over select.fast_elements()\r\n\t    _loop \r\n\t        _self.put_chars(write_string(rec.address1))\r\n\t        _self.flush()\r\n\t        _self.put_chars(write_string(rec.address2))\r\n\t        _self.flush()\r\n\t        _self.put_float(rec.location.x)\r\n\t        _self.flush()\r\n\t        _self.put_float(rec.location.y)\r\n\t        _self.flush()\r\n\t    _endloop \r\n\t_endmethod\r\n\t$\r\n\t</code></pre>\r\n\r\n1. Register method with protocol name. Name must be the same as in config file:\r\n\t\r\n\t<pre><code>\r\n\tgoworld.register_protocol(\"find_hotel\", :|find_hotel_protocol()|)\r\n\t$\r\n\r\n\t\r\n1. Start goworld worker:\r\n\t<pre><code>\r\n\tstart_goworld_worker(\"w1\", \"c:\\tmp\\goworld.exe\", \"c:\\tmp\\goworld.json\", \"c:\\tmp\\w1.log\")\r\n\t$\r\n\t</code></pre>\r\n\r\n1. Start HTTP server\r\n\t<pre><code>\r\n\tc:\\tmp\\goworld.exe -t http -c c:\\tmp\\goworld.json\r\n\t</code></pre>\r\n\r\n1. In browser type:\r\n\t<pre><code>\r\n\thttp://localhost:4000/find_hotel/[HOTEL_NAME]\r\n\t</code></pre>\r\n\r\n<div id='protocol'/>\r\n## Protocols\r\n\r\nPrototcol means the way how magik Acp and goworld worker are communicate.\r\n\r\n\r\n<div id='protocol-list'/>\r\n### List protocol\r\nList protocol starts with `list` prefix eg.\r\n\r\n`http://localhost:4000/list/gis/hotel/100/id/name/address1`\r\n\r\nRequest structure:\r\n`http://[HOST]:[PORT]/list/[DATASET]/[COLLECTION]/[LIMIT, 0 = ALL]/[LIST OF FIELDS SEPARATED BY \"/\"]``\r\n\r\nProtocol returns a list of JSON objects, each JSON object contain LIST OF FIELDS and VALUES from COLLECTION. Number of objects is limited by LIMIT or size of COLLECTION.\r\nIf DATASET or COLLECTION doesn not exists, error message is returned. If field does not exists error is returned as a field value.\r\n\r\nCommunication:\r\n\r\n1. `goworld` send to magik a char vector, this is a path from http address. eg for \r\n`http://localhost:4000/list/gis/hotel/100/id/name/address1/address2` it will be `gis/hotel/100/id/name/address1/address2`.\r\n\r\n\t<pre><code>\r\n\t_local path << _self.get_chars()\r\n\t</code></pre>\r\n\r\n1. magik ACP send to goworld information about status as `unsigned byte`\r\n   * `0` means `OK`, no error\r\n\r\n\t<pre><code>\r\n\t_self.put_unsigned_byte(0)\r\n\t</code></pre>\r\n   * `> 0` means error (no such dataset, no access). In this case as a next message magik need to send string with error message\r\n\t<pre><code>\r\n\t_self.put_unsigned_byte(1)\r\n\t_self.chars(write_string(\"No such dataset with name\", dataset_name))\r\n\t_continue\r\n\t</code></pre>\r\n\r\n\r\n1. magik ACP send to goworld number of record which will be send as `unsigned int`\r\n\t<pre><code>\r\n\t_self.put_unsigned_int(records_to_get)\r\n\t</code></pre>\r\n\r\n1. magik ACP send to goworld number of fields which will be send as `unsigned int`\r\n\t<pre><code>\r\n\t_self.put_unsigned_int(no_of_fields)\r\n\t</code></pre>\r\n\r\n1. in the loop magik ACP sends field names and field values\r\n\t<pre><code>\r\n\t_self.put_chars(field_name)\r\n\t_self.flush()\r\n\t_self.put_chars(field_value)\r\n\t_self.flush()\r\n\t</code></pre>\r\n\r\n<div id='protocol-custom'/>\r\n### Custom protocol\r\n\r\nTo define custom prototcol you need to:\r\n\r\n1. Define protocol in config file.\r\n\t1. Protocol name\r\n\t1. enabled flag\r\n\t1. List of entry parameters\r\n\t1. List of result fields\r\n1. Create magik method which will handle protocol on Smallworld side. This method need to:\r\n    1. Receive all parameters defined in config file\r\n\t1. Send sucess code, or error code and error message\r\n\t1. Send number of records to send\r\n\t1. In loop, send fields which are defined in config file\r\n1. Register magik method with protocol name\r\n\r\nSee example in [tutotrial](#tutorial-custom-protocol).\r\n\r\n\r\n<div id='stop'/>\r\n## Stop \r\nTo stop just open system Task Manager and kill all `goworld` processes.\r\n\r\n***\r\n\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}